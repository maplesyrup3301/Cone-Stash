# CMOS 门电路
## MOS管
### MOS管的输入特性与输出特性
考虑N沟道增强型MOS管的共源极电路：
```tikz
\usepackage{circuitikz}
\begin{document}
\begin{circuitikz}[american]

\draw (1, 0) node[nigfete, anchor=G](nfet1){}
(nfet1.gate) node[anchor=north east] {G}
(nfet1.drain) node[anchor=south east] {D}
(nfet1.source) node[anchor=north east] {S};
\draw (0, 0) -- (nfet1.gate);
\draw (0, 0) to[short, *-] ++(0, 0);
\draw (0, -1)  -| (nfet1.source);
\draw (0, -1) to[short, *-] ++(0, 0);
\draw (4, -1) -| (nfet1.source);
\draw (4, -1) to[short, *-] ++(0, 0);
\draw (4, 1) -| (nfet1.drain);
\draw (4, 1) to[short, *-] ++(0, 0);
\draw (0, 0) to[open, v=$v_{GS}$] (0, -1);
\draw (4, 1) to[open, v=$v_{DS}$] (4, -1);
\draw (4, 1) to[short, i=$i_D$] (4, 1-|nfet1.drain);
\draw (4, -1-|nfet1.source) node[ground]{};
\end{circuitikz}
\end{document}
```
当$v_{GS}<V_{GS(th)}$时MOS管处于截止状态，无导电沟道形成因此无电流通过，此区域称为截止区；
当$v_{GS}>V_{GS(th)}$时MOS管处于导通状态，导电沟道形成并且随着$v_{GS}$的增大而拓宽：
	在$v_{DS}$较小时电流小于导电沟道的最大承载量，$i_D$与$v_{DS}$成正比，此时MOS管近似于一个电阻，其阻值随着$v_{GS}$的增大而减小；此区域称为可变电阻区
	在$v_{DS}$较大时电流大于导电沟道的最大承载量，$i_D$随着$v_{DS}$的增大趋近于饱和电流；该饱和电流随着$v_{GS}$的增大而增大；此区域称为恒流区
$v_{DS}$对$v_{GS(th)}$的影响不大；
### MOS管基本开关电路
![[增强型NMOS.png]]
当$v_I<V_{GS(th)}$时，MOS管截止，因此输出$v_O=+V_{DD}$为高电平；
当$v_I>V_{GS(th)}$时，MOS管导通进入恒流区，如果$v_I$取较大则导通内阻$R_{ON}$较小；
若$R_D\gg R_{ON}$，则输出$v_O\approx 0$为低电平；
![[MOS管的等效.png]]
MOS管分为：
1. P型：栅极接负压
2. N型：栅极接正压
以及：
1. 增强型：默认截止，栅极电压增大后导通
2. 耗尽型：默认导通，栅极电压减小后截止
记忆口诀是：
NP相反（N型栅极却接正压，P型栅极接负压）
入不负出
## CMOS 反相器
CMOS反相器的结构如图所示：
![[CMOS反相器.png]]
注意到反相器不是几个独立MOS管形成的电路，而是在同一块半导体上制作的
因此后面我们还需要考虑到CMOS反相器内部寄生的三极管

已知$T_1, T_2$的开启电压为$V_{GS(th)P},V_{GS(th)N}$；令$V_{DD}>V_{GS(th)P}+|V_{GS(th)N}|$
若$v_1=0$时：
$v_{GS1}=-V_{DD}<V_{GS(th)N}$，$T_1$导通；
$v_{GS2}=0<V_{GS(th)P}$，$T_2$截止；
因此$v_O\approx V_{DD}$为高电平
若$v_1=V_{DD}$时：
$v_{GS1}=0>V_{GS(th)N}$，$T_1$截止；
$v_{GS2}=V_{DD}>V_{GS(th)P}$，$T_2$导通；
因此$v_{O}\approx0$为低电平
![[CMOS反相器的电压特性.png|250]]![[CMOS反相器的电流特性.png|250]]
由图可以看出，反相器在$v_I=0.5V_{DD}$时也输出$0.5V_{DD}$，此时两管内阻相等，该电压称为反相器的阈值电压；
在高电平或低电平区间内，由于截止管的内阻巨大，因此电流都很小；而在过渡区两管内阻大小都中等，因此电流大；因此我们一般希望反相器工作在高电平或者低电平区，否则MOS管可能因功耗大而损坏；
在保证输出电平波动不大的条件下，输入端电平的允许波动范围称为输入端的噪声容限；考虑门电路级间传递的电平，可知噪声容限的公式：
$$
V_{NH}=V_{OH(min)}-V_{IH(min)}, V_{NL}=V_{IL(max)}-V_{OL(max)}
$$
在CMOS门电路中，当负载为门电路的情况下我们规定：
$V_{OH(min)}=V_{DD}-0.1\text V, V_{OL(max)}=V_{SS}+0.1\text V$
其中$V_{SS}$表示反相器中N沟道管的源极电压；
### CMOS反相器的静态特性
#### 输入特性
MOS管的运作需要形成电场：中间的栅极之所以能够吸引载流子，就是因为与基底形成了电容；因为氧化物薄膜非常薄，保护MOS管实质上就是保护这个微小电容不被击穿；
实际生产的各种反相器都采用了输入保护措施，简而言之就是在输入端加上一对钳位二极管；尽管如此，在极大的电流下MOS管仍可能被击穿，因此仍然须要注意正确使用MOS管；
![[CMOS反相器的输入保护.png]]
当$-V_{SS}-0.7\text V < v_I < V_{DD}+0.7\text V$时，电路正常工作，此时等效为(c)图
当$v_I$超过上下钳位阈值，二极管导通且电流迅速增大，此时电流主要经过二极管
![[CMOS反相器的输入特性.png|400]]
#### 输出特性
1. 低电平输出特性
输入为高电平时，$T_N$导通，$T_P$截止，此时$v_O=i_{O}R_{on}$
其中$R_{on}$就是可变电阻区内此情况下$T_N$的等效电阻
2. 高电平输出特性
输入为低电平时，$T_P$导通，$T_N$截止，此时$v_O=V_{DD}-i_{O}R_{on}$
其中$R_{on}$就是可变电阻区内此情况下$T_P$的等效电阻
### CMOS反相器的动态特性
对于CMOS电路，有传输延迟时间$t_{PHL}=t_{PLH}$
反相器的交流噪声容限随着噪声脉冲作用时间的延长而减小，最后趋于稳定
在反相器状态转换过程中产生的功耗称为动态功耗
其中：
电容充放电产生的功耗：$P_C=C_LfV_{DD}^2$
过渡态产生的功耗：$P_T=C_{PD}fV_{DD}^2$
其中$C_{PD}$为厂家给出的功耗电容
动态功耗总的为：$P_D=P_T+P_C$
静态功耗$P_S$很小，因此一般只计算动态功耗
## 其他CMOS逻辑门
### 与非门
其结构如下：
![[CMOS与非门.png|400]]
$T_2, T_4$组成了一个$N$-高阻与门，$T_1, T_3$组成了一个$P$-高阻或门
仅当$A=B=1$时，$T_2, T_4$同时导通，$T_1, T_3$同时截止，输出低电平；
上述电路的问题：
1. 不同输入，输出电阻不同；
2. 增加输入端数量会影响输出电平；
3. 输入状态不同时对电压传输特性有影响；
### 或非门
其结构如下：
![[CMOS或非门.png|400]]
其分析与缺点都类似上述的与非门
为了改进上述门电路的缺点，实际中在每个输入、输出端都加入一个反相器作为缓冲级；此时原电路的逻辑功能也发生了变化
### OD门
将CMOS门电路的输出级做成漏极开路的形式，称为漏极开路输出的门电路， 简称OD门；可实现输出电平的变换、输出大负载电流和“线与”等功能。
![[Pasted image 20241009172742.png|500]]
左图是OD输出与非门74HC03的结构；右图是其电路标志
菱形下的横线表示输出低电平时为低输出电阻；
OD门工作时需要将输出端经上拉电阻$R_L$接到高电平上
$T_N$的栅极所接信号为$AB$，而$T_N$与上拉电阻构成一个非门，因此总体是与非门
![[Pasted image 20241009174022.png|500]]
OD门的输出可以直接连接使用，此时各个输出端的MOS管组成了一个$N$-高阻或门，总的来看形成了线与连接，即$Y=Y_1Y_2$

OD门要求选取合适的上拉电阻$R_L$
![[Pasted image 20241009174159.png|600]]
当上一级输出高电平，流过$R_L$的电流是上一级所有漏电流和下一级所有输入端电流之和；设上一级有$n$个OD门，下一级有$m$个输入端；每个MOS管的漏电流为$I_{OH}$，每个输入端拉取电流为$I_{IH}$，要求输出电压不低于$V_{OH}$；可以求得$R_{L(max)}$
$$
R_L\leq\frac{V_{DD}-V_{OH}}{nI_{OH}+mI_{IH}}=R_{L(max)}
$$

当上一级输出低电平且只有一个NMOS导通，若允许的最大负载电流为$I_{OL(max)}$，下一级每个输入端的输入电流为$I_{IL}$，此时输出低电平$V_{OL}$；可以求得$R_{L(min)}$
$$
R_L\geq\frac{V_{DD}-V_{OL}}{I_{(OL)max}-m|I_{IL}|}=R_{L(min)}
$$
### 传输门
利用NMOS和PMOS的互补性可以构造双向器件——传输门
![[Pasted image 20241009175229.png|500]]
$C$和$C'$是互补控制端：
当$C=1$时$C'=0$，此时两管均导通；
当$C=0$时$C'=1$，此时两管均截止
![[Pasted image 20241009175720.png|500]]
传输门的一个重要用途是作双向模拟开关
### 三态门
![[Pasted image 20241009175835.png|500]]
当$EN'=0$，其功能等同于一个非门；当$EN'=1$时其输出高阻态
它常被用于电路的输出端，从而允许多个输出连接到同一根总线上，只要满足任何时刻没有两个三态门同时使能即可；
# TTL 门电路
## BJT管
### BJT管的输入特性与输出特性
![[Pasted image 20241009180431.png|500]]
当$i_B=0$时，管子处在截止区，此时$i_C$几乎等于零，仅有微小的反向穿透电流流过；
当$i_B>0$时但$v_{CE}$较小时，管子收集电子的能力不如发射极发射电子的能力强，集电极饱和，因此处于饱和区
当$i_B>0$且$v_{CE}$较大时，管子收集电子的能力大于发射极发射电子的能力，此时电流就取决于发射极发射电子的能力，$i_C$几乎只受$i_B$的控制，且这种控制成正比
### BJT基本开关电路
![[Pasted image 20241009181550.png|200]]
BJT管的基本开关电路如图；
当$v_I<V_{ON}$时，三极管截止，输出高电平；
当$v_I>V_{ON}$时，三极管逐渐导通；
当三极管深度导通，此时的输出电压$V_{CE(sat)}$和电阻$R_{CE(sat)}$
可以求出深度饱和电流：
$$
I_{BS}=\frac{V_{CC}-V_{CE(sat)}}{\beta(R_C+R_{CE(sat)})}\approx\frac{V_{CC}}{\beta R_{C}}
$$
此时的$\beta$比线性区要小且不是常数，因此取线性区的$\beta$计算会导致$I_{BS}$偏小
![[Pasted image 20241009182539.png|600]]
其等效如上图；
三极管内部电流的建立要滞后于电压的变化；
## TTL 反相器
下图是TTL反相器的电路结构：
![[Pasted image 20241009182724.png|300]]![[Pasted image 20241011152120.png|300]]
设电源电压$V_{CC}=5 \text{V}$，且$V_{IH}=3.4\text V, V_{IL}=0.2\text V$
认为开启电压$V_{ON}=0.7\text V$

无论输入高电平还是低电平，$T_1$均导通，因此有$v_{B2}=v_I$
- （截止区）当$v_I<0.6\text V$时，$T_2$截止：
$v_{B4}\approx 5\text V$，$T_4$导通；$v_{B5}=0$，$T_5$截止；
$v_{O}=v_{CC}-v_{R2}-2V_{ON}\approx3.4\text V$；
- （线性区）当$0.7\text V<v_I<1.3 \text V$时，$T_2$放大：
$$
v_{B4}=V_{CC}-\frac{R_2}{R_3}(v_I-0.7)=5-1.6(v_I-0.7)
$$
$T_4$导通
$v_{B5}=v_{B2}-0.7<V_{ON}$，$T_5$截止；
$v_O=4.72-1.6v_I$；
- （转折区）当$v_I=V_{TH}\approx 1.4\text V$时，$T_2$放大：
$v_{B5}\geq V_{ON}$，$T_5$导通；
$v_{B2}$被钳位至$1.4\text V$，而$v_{C2}\approx 0.7\sim 1\text V$，$T_2$饱和；
$v_{B4}=v_{C2}<1.4\text V$，因此$T_4$与$D_2$截止；
$v_O\approx 0.3\text V$
- （饱和区）当$v_I>V_{TH}$时，由于$v_{B1}=2.1\text V$（钳位），$T_1$的发射结截止（倒置）
此时$v_I$不再影响$v_O$，保持低电平输出

74系列的输入噪声容限为：

| 单位: V | 输入端 | 输出端 |
| :---: | :-: | :-: |
| 最高低电平 | 0.8 | 0.4 |
| 最低高电平 | 2.0 | 2.4 |
可见$V_{NH}=V_{NL}=0.4\text V$
### TTL反相器的静态特性
#### 输入特性
![[Pasted image 20241011160957.png]]
当$V_{CC}=5\text V, v_I=V_{IL}$时，输入端低电平电流为：
$$
I_{IL}=-\frac{V_{CC}-v_{BE1}-V_{IL}}{R_1}\approx -1\text{mA}
$$
当$v_I=0$时的输入电流称为输入短路电流$I_IS$，比$I_IL$稍大，在近似计算时常常用输入短路电流代替输入低电平电流；

输入端高电平时$T_1$倒置，导致输入电流很小，74系列的$I_{IH}$在$40\mu\text{A}$以下

![[Pasted image 20241011162455.png]]
实际使用中，有时需要将输入端与大地或者低电平用电阻相连，由于输入电流是流出输入端的，因此电阻两端的电压会抬高输入电压；具体情况如图
- 当$R_P\leq 0.7\text {k}\ohm$时，构成低电平输入
- 当$R_P\geq 1.5\text k\ohm$时以及悬空时，构成高电平输入
#### 输出特性
1. 高电平输出特性
![[Pasted image 20241011161343.png]]
输出高电平时，随着输出电流增大，$R_4$两端的电压增大，$T_4$将进入饱和；由图可见此时电压几乎随着电流的增大线性减小
实际上，74系列门电路规定输出高电平时，最大负载电流不能超过$0.4\text {mA}$，若$V_{OH}=2.4\text V$，当$I_{OH}=-0.4\text {mA}$时内部消耗的功率已达1 mW
2. 低电平输出特性
![[Pasted image 20241011161726.png]]
输出低电平时，由于$T_5$的饱和导通电阻很低，因此仅随着电流的增大缓慢地线性增大；
### TTL反相器的动态特性
由于寄生电容和结电容的存在，TTL门的平均传输延时为3~40 ns
另一方面，当输入极窄的脉冲式，由于响应不及，输出变化很小，因此交流噪声容限明显大于直流噪声容限：
![[Pasted image 20241011163225.png]]

在实际工作中，由于状态转换时导通必然先于截止，因此会存在一段非常短的时间，两个三极管均导通，产生较大的尖峰电流
## 其他TTL逻辑门
### 与非门
![[Pasted image 20241011163711.png]]
该电路与反相器的唯一区别是将$T_1$换为了多发射极三极管，多发射极三极管就承担了与门的作用
### 或非门
![[Pasted image 20241011164525.png]]
该电路就是两个反相器并联在同一个输出级上，并联承担了或门的作用；这种并联结构简记为两个相对的三极管
### 与或非门
![[Pasted image 20241011164641.png]]
该门结合了上述两种门的结构；$Y=(AB+CD)'$
### 异或门
![[Pasted image 20241011164952.png]]
$T_4=B$，$T_5=A$，得到$T_7=(A+B)'$
又$T_6=AB$，得到
$Y=(AB+(A+B)')'=(A'+B')(A+B)=A'B+AB'$
### OC门
![[Pasted image 20241011165409.png]]
OC门就是TTL版本的OD门，输出端依然要外加一个电压
从而使得TTL电路中也可以实现线与功能

上拉电阻的计算与OD门相似，但是注意对于OC门来说$m$不等于输入端的数量
对于与输入端，输入电流乘上的是负载门的数量；
对于或输入端，输入电流乘上的是输入端的数量；
### 三态门
![[Pasted image 20241011170540.png|400]]
三态门在CMOS部分已经介绍过，此略
## TTL系列的改进型
为了满足用户的要求，即提高工作速度和降低功耗两个方面，在74系列逻辑门电路的基础上，出现了74H系列、74S系列、74LS系列、74AS系列和74ALS系列。下面简单介绍它们的电路结构和电气特性。
1. 高速系列74H/54H
输出极采用达林顿结构
与74系列相比采用达林顿管，其β提高，输出高电平时输出电阻减小，缩短对负载电容的充电速度；电阻的减小使得电平的转换加快，故其平均传输延迟时间比74系列门电路缩短一半，通常为10ns以内。但电阻减小又使得功耗增大。
2. 肖特基系列74S/54S
在74S系列的门电路中采用抗饱和三极管
从而提高管子的开关速度，降低传输延迟时间
3. 低功耗肖特基系列74LS/54LS
传输延迟时间短,功耗降低
4. 74AS系列
电路和74LS系列相似，但采用低阻值电阻，故传输延迟时间较短，工作速度提高。但功耗要74LS系列的大些。
5. 74ALS系列
为了降低延迟－功率积，采用较高阻值电阻，缩小器件的尺寸，在电路也做了局部的改进。其DP积是74系列门电路中最小的一种。